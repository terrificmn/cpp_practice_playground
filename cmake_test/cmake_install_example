cmake_minimum_required(VERSION 3.10)
project(FileManagementExample VERSION 1.0)

# Specify the C++ standard
set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Create some example files during configuration time
file(WRITE ${CMAKE_BINARY_DIR}/config.txt "This is a configuration file\n")
file(WRITE ${CMAKE_BINARY_DIR}/data.json "{ \"key\": \"value\" }\n")

# Method 1: Using install() command
# This will be executed when you run 'cmake --install .' or 'make install'
install(FILES 
    ${CMAKE_BINARY_DIR}/config.txt
    ${CMAKE_BINARY_DIR}/data.json
    DESTINATION ${CMAKE_SOURCE_DIR}/config
)

# Method 2: Using file(COPY) during configuration
# This happens immediately when you run cmake
file(COPY ${CMAKE_BINARY_DIR}/config.txt
     DESTINATION ${CMAKE_SOURCE_DIR}/immediate_copy
)

# Method 3: Using add_custom_command
# This happens during build time
add_custom_command(
    OUTPUT ${CMAKE_SOURCE_DIR}/build_time_copy/config.txt
    COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_SOURCE_DIR}/build_time_copy
    COMMAND ${CMAKE_COMMAND} -E copy
            ${CMAKE_BINARY_DIR}/config.txt
            ${CMAKE_SOURCE_DIR}/build_time_copy/config.txt
    DEPENDS ${CMAKE_BINARY_DIR}/config.txt
)

# Create a custom target to ensure the copy command runs
add_custom_target(copy_files ALL
    DEPENDS ${CMAKE_SOURCE_DIR}/build_time_copy/config.txt
)

# Method 4: Using file(GENERATE)
# This generates files during build generation
file(GENERATE 
    OUTPUT ${CMAKE_SOURCE_DIR}/generated/config_${CMAKE_BUILD_TYPE}.txt
    CONTENT "Configuration for build type: ${CMAKE_BUILD_TYPE}\n"
)

# Example executable
add_executable(myapp main.cpp)

# Method 5: Copy files relative to executable location
set_target_properties(myapp PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
)

# Install the executable and its required files
install(TARGETS myapp
    RUNTIME DESTINATION ${CMAKE_SOURCE_DIR}/installed_app/bin
)

install(FILES ${CMAKE_BINARY_DIR}/config.txt
    DESTINATION ${CMAKE_SOURCE_DIR}/installed_app/config
)

# Create a function to copy files
function(copy_project_file SOURCE_FILE DESTINATION_DIR)
    get_filename_component(FILENAME ${SOURCE_FILE} NAME)
    add_custom_command(
        TARGET myapp POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E make_directory ${DESTINATION_DIR}
        COMMAND ${CMAKE_COMMAND} -E copy
                ${SOURCE_FILE}
                ${DESTINATION_DIR}/${FILENAME}
        COMMENT "Copying ${FILENAME} to ${DESTINATION_DIR}"
    )
endfunction()

# Use the custom function
copy_project_file(${CMAKE_BINARY_DIR}/config.txt ${CMAKE_SOURCE_DIR}/custom_copy)